{"title":"Mail函数禁用下添加WordPress评论回复邮件通知","uid":"c87e7ce638abc19774c3ede9965f3d29","slug":"wordpress-email","date":"2016-08-03T07:38:19.000Z","updated":"2021-04-11T09:44:33.294Z","comments":true,"path":"api/articles/wordpress-email.json","keywords":"逃跑计划,Blog,Developer,Front-end,前端,Apple,小技巧","cover":"https://cdn.blog.hopenet.tech/thumbnail/smtp-email.png","content":"<p>本次教程利用插件在虚拟主机 Or VPS 在 Mail 函数被禁用的情况下，添加WordPress评论回复邮件通知功能，更好的对用户进行交流。</p>\n<span id=\"more\"></span>\n\n<p>自己折腾了好久，一直Google不出一个心目中完美的解决方案</p>\n<p>只能借助插件，<a href=\"https://wordpress.org/plugins/wp-mail-smtp/\">WP-Mail-SMTP</a> ，插件作者：<a href=\"http://www.callum-macdonald.com/\">Callum Macdonald</a></p>\n<p>附上一个我的设置方法吧</p>\n<p>WP后台 - 设置 - Email</p>\n<p><img src=\"https://cdn.blog.hopenet.tech/article/wordpress-email/smtp.png\" alt=\"smtp\"></p>\n<p>不同的邮箱有不同的设置方法，具体仅需要修改：host、port、encryption 这三项内容</p>\n<p>设置好后可以在Send a Test Email下输入自己的邮箱，进行测试，是否配置成功。</p>\n<p>好了，SMTP设置好后就可以进入正题：添加WordPress评论回复邮件通知功能</p>\n<p>仅仅需要做的只是拷贝代码到 functions.php</p>\n<p>样式一：</p>\n<pre><code>/* comment_mail_notify v1.0 by willin kan. (所有回复都发送邮件) */\nfunction comment_mail_notify($comment_id) &#123;\n  $comment = get_comment($comment_id);\n  $parent_id = $comment-&gt;comment_parent ? $comment-&gt;comment_parent : &#39;&#39;;\n  $spam_confirmed = $comment-&gt;comment_approved;\n  if (($parent_id != &#39;&#39;) &amp;&amp; ($spam_confirmed != &#39;spam&#39;)) &#123;\n    $wp_email = &#39;e-mail@&#39; . preg_replace(&#39;#^www\\.#&#39;, &#39;&#39;, strtolower($_SERVER[&#39;SERVER_NAME&#39;])); //e-mail发出点, no-reply可改为可用的e-mail.\n    $to = trim(get_comment($parent_id)-&gt;comment_author_email);\n    $subject = &#39;您在[&#39; . get_option(&quot;blogname&quot;) . &#39;]的留言有了回应&#39;;\n    $message = &#39;\n    &lt;div style=&quot;background-color:#eef2fa; border:1px solid #d8e3e8; color:#111; padding:0 15px; -moz-border-radius:5px; -webkit-border-radius:5px; -khtml- border-radius:5px; border-radius:5px;&quot;&gt;\n\nHi！&#39; . trim(get_comment($parent_id)-&gt;comment_author) . &#39;\n\n您曾在 &#39; . get_option(&quot;blogname&quot;) . &#39; - 《&#39; . get_the_title($comment-&gt;comment_post_ID) . &#39;》的留言:\n&#39;\n       . trim(get_comment($parent_id)-&gt;comment_content) . &#39;\n\n&#39; . trim($comment-&gt;comment_author) . &#39;给您的回应:\n&#39;\n       . trim($comment-&gt;comment_content) . &#39;\n\n您可以点击[ &#39;comment&#39;))) . &#39;&quot;&gt;直接回复Ta！]()\n\n(此邮件由系统自动发出, 请勿直接回复。)\n\n    &lt;/div&gt;&#39;;\n    $from = &quot;From: \\&quot;&quot; . get_option(&#39;blogname&#39;) . &quot;\\&quot; &lt;$wp_email&gt;&quot;;\n    $headers = &quot;$from\\nContent-Type: text/html; charset=&quot; . get_option(&#39;blog_charset&#39;) . &quot;\\n&quot;;\n    wp_mail( $to, $subject, $message, $headers );\n    //echo &#39;mail to &#39;, $to, &#39;\n &#39; , $subject, $message; // for testing\n  &#125;\n&#125;\nadd_action(&#39;comment_post&#39;, &#39;comment_mail_notify&#39;);\n</code></pre>\n<p>样式二：</p>\n<pre><code>//评论回复邮件\nfunction comment_mail_notify($comment_id) &#123;\n$comment = get_comment($comment_id);\n$parent_id = $comment-&gt;comment_parent ? $comment-&gt;comment_parent : &#39;&#39;;\n$spam_confirmed = $comment-&gt;comment_approved;\nif (($parent_id != &#39;&#39;) &amp;&amp; ($spam_confirmed != &#39;spam&#39;)) &#123;\n$wp_email = &#39;no-reply@&#39; . preg_replace(&#39;#^www\\.#&#39;, &#39;&#39;, strtolower($_SERVER[&#39;admin@perdel.cn&#39;]));//发件人e-mail地址\n$to = trim(get_comment($parent_id)-&gt;comment_author_email);\n$subject = &#39;您在 [&#39; . get_option(&quot;blogname&quot;) . &#39;] 的留言有了回应&#39;;\n$message = &#39;&lt;div style=&quot;border-right:#666666 1px solid;border-radius:8px;color:#111;font-size:12px;width:702px;border-bottom:#666666 1px solid;font-family:微软雅黑,arial;margin:10px auto 0px;border-top:#666666 1px solid;border-left:#666666 1px solid&quot;&gt;&lt;div class=&quot;adM&quot;&gt;\n&lt;/div&gt;&lt;div style=&quot;width:100%;background:#666666;min-height:60px;color:white;border-radius:6px 6px 0 0&quot;&gt;&lt;span style=&quot;line-height:60px;min-height:60px;margin-left:30px;font-size:12px&quot;&gt;您在[&#39; . get_option(&#39;blogname&#39;) . &#39;]() 上的留言有回复啦！&lt;/span&gt; &lt;/div&gt;\n&lt;div style=&quot;margin:0px auto;width:90%&quot;&gt;\n\n&#39; . trim(get_comment($parent_id)-&gt;comment_author) . &#39;, 您好!\n\n您于&#39; . trim(get_comment($parent_id)-&gt;comment_date) . &#39; 在文章《&#39; . get_the_title($comment-&gt;comment_post_ID) . &#39;》上发表评论: \n\n&#39; . nl2br(get_comment($parent_id)-&gt;comment_content) . &#39;\n\n&#39; . trim($comment-&gt;comment_author) . &#39; 于&#39; . trim($comment-&gt;comment_date) . &#39; 给您的回复如下: \n\n&#39; . nl2br($comment-&gt;comment_content) . &#39;\n\n您可以点击 [查看回复的完整內容]()\n\n感谢你对 [&#39; . get_option(&#39;blogname&#39;) . &#39;]() 的关注，如您有任何疑问，欢迎在博客留言，我会一一解答\n\n(此邮件由系统自动发出，请勿回复。)\n&lt;/div&gt;&lt;/div&gt;&#39;;\n$from = &quot;From: \\&quot;&quot; . get_option(&#39;blogname&#39;) . &quot;\\&quot; &lt;$wp_email&gt;&quot;;\n$headers = &quot;$from\\nContent-Type: text/html; charset=&quot; . get_option(&#39;blog_charset&#39;) . &quot;\\n&quot;;\nwp_mail( $to, $subject, $message, $headers );\n//echo &#39;mail to &#39;, $to, &#39;\n &#39; , $subject, $message; // for testing\n&#125;\n&#125;\nadd_action(&#39;comment_post&#39;, &#39;comment_mail_notify&#39;);\n</code></pre>\n<p>如果没用的话不用着急，这是因为WP-MAIL-SMTP插件的问题</p>\n<p>插件默认的情况下非管理员邮件是不会进行发信的</p>\n<p>那么只需要在后台找到以下代码进行注释即可</p>\n<pre><code>// If the from email is not the default, return it unchanged\nif ( $orig != $default_from ) &#123;\n    return $orig;\n  &#125;\n</code></pre>\n<p>之后你可以在文章下进行测试，如果成功你可以收到这么一封邮件！</p>\n<p><img src=\"https://cdn.blog.hopenet.tech/article/wordpress-email/email.png\" alt=\"email\"></p>\n<p>大功告成！ ;-) </p>\n","feature":null,"text":"本次教程利用插件在虚拟主机 Or VPS 在 Mail 函数被禁用的情况下，添加WordPress评论回复邮件通知功能，更好的对用户进行交流。 自己折腾了好久，一直Google不出一个心目中完美的解决方案 只能借助插件，WP-Mail-SMTP ，插件作者：Callum Macd...","link":"","photos":[],"count_time":{"symbolsCount":"4.8k","symbolsTime":"4 mins."},"categories":[{"name":"技术栈","slug":"技术栈","count":2,"path":"api/categories/技术栈.json"}],"tags":[{"name":"WordPress","slug":"WordPress","count":2,"path":"api/tags/WordPress.json"},{"name":"Mail","slug":"Mail","count":1,"path":"api/tags/Mail.json"}],"toc":"","author":{"name":"Andy","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"","description":"愿风指引着你的道路，愿你的刀刃永远锋利","socials":{"github":"https://github.com/liwuxi","twitter":"https://twitter.com/imwuxi","stackoverflow":"","wechat":"","qq":"","weibo":"https://www.weibo.com/imlevis","zhihu":"","csdn":"","juejin":""}},"mapped":true,"prev_post":{"title":"Hello Hexo, bye WordPress","uid":"5d2ef3511073923c42202f4396a1a71f","slug":"Hello-Hexo","date":"2018-02-06T15:01:16.000Z","updated":"2021-04-11T09:44:33.294Z","comments":true,"path":"api/articles/Hello-Hexo.json","keywords":"逃跑计划,Blog,Developer,Front-end,前端,Apple,小技巧","cover":"https://cdn.blog.hopenet.tech/thumbnail/byewordpress.png","text":"前言2015年7月7日，一个小萌新在万网买下了第一个域名，购买了一台美国洛杉矶的VPS，开始在互联网上建立起了自己的第一个博客。 自豪地采用WordPress！ 这是我对 WordPress 印象最深的一句话。 博客的几次 改版 折腾都没使我放弃这个博客程序，原因无非就是比较熟悉...","link":"","photos":[],"count_time":{"symbolsCount":643,"symbolsTime":"1 mins."},"categories":[{"name":"日志","slug":"日志","count":3,"path":"api/categories/日志.json"}],"tags":[{"name":"记事","slug":"记事","count":2,"path":"api/tags/记事.json"}],"author":{"name":"Andy","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"","description":"愿风指引着你的道路，愿你的刀刃永远锋利","socials":{"github":"https://github.com/liwuxi","twitter":"https://twitter.com/imwuxi","stackoverflow":"","wechat":"","qq":"","weibo":"https://www.weibo.com/imlevis","zhihu":"","csdn":"","juejin":""}}},"next_post":{"title":"配置Wordpress使网站强制HTTPS访问","uid":"c24bf6860b3681d01b2e59b76b535050","slug":"wordpress-https","date":"2016-01-26T02:37:41.000Z","updated":"2021-04-11T09:44:33.294Z","comments":true,"path":"api/articles/wordpress-https.json","keywords":"逃跑计划,Blog,Developer,Front-end,前端,Apple,小技巧","cover":"https://cdn.blog.hopenet.tech/thumbnail/wordpress-https.png","text":"HTTPS协议越来越普及，Google、百度等搜索引擎也大大地对HTTPS增加友好度各大网站也开启了全站SSL，比如淘宝、百度等，也意味着互联网HTTPS时代的到来。 为了跟上互联网时代的热潮，大家跟我一起来简单的配置即可开启全站HTTPS强制访问！ 1.将配置好的SSL证书添加...","link":"","photos":[],"count_time":{"symbolsCount":"1.3k","symbolsTime":"1 mins."},"categories":[{"name":"技术栈","slug":"技术栈","count":2,"path":"api/categories/技术栈.json"}],"tags":[{"name":"WordPress","slug":"WordPress","count":2,"path":"api/tags/WordPress.json"},{"name":"HTTPS","slug":"HTTPS","count":1,"path":"api/tags/HTTPS.json"}],"author":{"name":"Andy","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"","description":"愿风指引着你的道路，愿你的刀刃永远锋利","socials":{"github":"https://github.com/liwuxi","twitter":"https://twitter.com/imwuxi","stackoverflow":"","wechat":"","qq":"","weibo":"https://www.weibo.com/imlevis","zhihu":"","csdn":"","juejin":""}}}}